<app-admin-header></app-admin-header>
<app-admin-sidebar></app-admin-sidebar>
<main id="main" class="main">
  <div class="pagetitle mb-4">
    <h1 class="fw-bold">User Details</h1>

    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/admin">Dashboard</a></li>
        <li class="breadcrumb-item"><a routerLink="/admin/users">Users</a></li>
        <li class="breadcrumb-item active">Details</li>
      </ol>
    </nav>
  </div>
  <section class="section">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="framed-content shadow-sm">
          <h5 class="card-title fw-semibold text-center">User Information</h5>
          <div class="alert alert-danger" *ngIf="errorMessage">{{ errorMessage }}</div>
          <div *ngIf="user" class="details-container">
            <div class="row mb-3">
              <div class="col-sm-4 fw-bold">Username:</div>
              <div class="col-sm-8">{{ user.username }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-4 fw-bold">Full Name:</div>
              <div class="col-sm-8">{{ user.firstName }} {{ user.lastName }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-4 fw-bold">Email:</div>
              <div class="col-sm-8">{{ user.email }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-4 fw-bold">Role:</div>
              <div class="col-sm-8">{{ user.role }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-4 fw-bold">Profile:</div>
              <div class="col-sm-8">{{ user.profile?.designation || 'N/A' }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-4 fw-bold">Status:</div>
              <div class="col-sm-8">{{ user.status }}</div>
            </div>
            <div class="row mb-3" *ngIf="user.birthdate">
              <div class="col-sm-4 fw-bold">Birthdate:</div>
              <div class="col-sm-8">{{ user.birthdate }}</div>
            </div>
            <div class="row mb-3" *ngIf="user.gender">
              <div class="col-sm-4 fw-bold">Gender:</div>
              <div class="col-sm-8">{{ user.gender }}</div>
            </div>
            <div class="row mb-3" *ngIf="user.address">
              <div class="col-sm-4 fw-bold">Address:</div>
              <div class="col-sm-8">{{ user.address }}</div>
            </div>
            <div class="row mb-3" *ngIf="user.phoneNumber">
              <div class="col-sm-4 fw-bold">Phone Number:</div>
              <div class="col-sm-8">{{ user.phoneNumber }}</div>
            </div>
            <!-- Central Admin Fields -->
            <div *ngIf="user.role === 'CENTRAL_ADMIN'">
              <div class="row mb-3" *ngIf="user.department">
                <div class="col-sm-4 fw-bold">Department:</div>
                <div class="col-sm-8">{{ user.department }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.accessLevel">
                <div class="col-sm-4 fw-bold">Access Level:</div>
                <div class="col-sm-8">{{ user.accessLevel }}</div>
              </div>
            </div>
            <!-- Admin/Teacher Fields -->
            <div *ngIf="user.role === 'CENTRAL_ADMIN' || user.role === 'LOCAL_ADMIN' || user.role === 'TEACHER'">
              <div class="row mb-3" *ngIf="user.employeeId">
                <div class="col-sm-4 fw-bold">Employee ID:</div>
                <div class="col-sm-8">{{ user.employeeId }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.hireDate">
                <div class="col-sm-4 fw-bold">Hire Date:</div>
                <div class="col-sm-8">{{ user.hireDate }}</div>
              </div>
            </div>
            <!-- Local Admin Fields -->
            <div *ngIf="user.role === 'LOCAL_ADMIN'">
              <div class="row mb-3" *ngIf="user.schoolNameLocalAdmin">
                <div class="col-sm-4 fw-bold">School Name:</div>
                <div class="col-sm-8">{{ user.schoolNameLocalAdmin }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.adminCode">
                <div class="col-sm-4 fw-bold">Admin Code:</div>
                <div class="col-sm-8">{{ user.adminCode }}</div>
              </div>
            </div>
            <!-- Teacher Fields -->
            <div *ngIf="user.role === 'TEACHER'">
              <div class="row mb-3" *ngIf="user.subjectSpecialization">
                <div class="col-sm-4 fw-bold">Subject Specialization:</div>
                <div class="col-sm-8">{{ user.subjectSpecialization }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.qualification">
                <div class="col-sm-4 fw-bold">Qualification:</div>
                <div class="col-sm-8">{{ user.qualification }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.teacherRank">
                <div class="col-sm-4 fw-bold">Teacher Rank:</div>
                <div class="col-sm-8">{{ user.teacherRank }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.schoolNameTeacher">
                <div class="col-sm-4 fw-bold">School Name:</div>
                <div class="col-sm-8">{{ user.schoolNameTeacher }}</div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-4 fw-bold">Programs:</div>
                <div class="col-sm-8">
                  <ul class="list-group">
                    <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let program of user.programs">
                      {{ program.name }}
                      <button
                        class="btn btn-sm btn-danger"
                        (click)="initiateRemoveProgram(program)"
                        title="Remove Program"
                        *ngIf="isAuthorized"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </li>
                    <li class="list-group-item" *ngIf="!user.programs || user.programs.length === 0">
                      No programs assigned
                    </li>
                  </ul>
                  <div class="mt-3" *ngIf="isAuthorized">
                    <select [formControl]="selectedProgram" class="form-select mb-2">
                      <option value="">Select a program to add</option>
                      <option *ngFor="let program of programs" [value]="program.id">{{ program.name }}</option>
                    </select>
                    <button
                      class="btn btn-primary btn-icon-text"
                      (click)="initiateAddProgram()"
                      [disabled]="!selectedProgram.value"
                    >
                      <span class="plus-icon">+</span> Add Program
                    </button>
                    <div class="alert alert-danger mt-2" *ngIf="programError">{{ programError }}</div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Student Fields -->
            <div *ngIf="user.role === 'STUDENT'">
              <div class="row mb-3" *ngIf="user.studentId">
                <div class="col-sm-4 fw-bold">Student ID:</div>
                <div class="col-sm-8">{{ user.studentId }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.enrollmentDate">
                <div class="col-sm-4 fw-bold">Enrollment Date:</div>
                <div class="col-sm-8">{{ user.enrollmentDate }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.gradeLevel">
                <div class="col-sm-4 fw-bold">Grade Level:</div>
                <div class="col-sm-8">{{ user.gradeLevel }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.schoolClass">
                <div class="col-sm-4 fw-bold">School Class:</div>
                <div class="col-sm-8">{{ user.schoolClass }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.parentName">
                <div class="col-sm-4 fw-bold">Parent Name:</div>
                <div class="col-sm-8">{{ user.parentName }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.parentContact">
                <div class="col-sm-4 fw-bold">Parent Contact:</div>
                <div class="col-sm-8">{{ user.parentContact }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.previousSchool">
                <div class="col-sm-4 fw-bold">Previous School:</div>
                <div class="col-sm-8">{{ user.previousSchool }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.medicalConditions">
                <div class="col-sm-4 fw-bold">Medical Conditions:</div>
                <div class="col-sm-8">{{ user.medicalConditions }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.studentStatus">
                <div class="col-sm-4 fw-bold">Student Status:</div>
                <div class="col-sm-8">{{ user.studentStatus }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.schoolNameStudent">
                <div class="col-sm-4 fw-bold">School Name:</div>
                <div class="col-sm-8">{{ user.schoolNameStudent }}</div>
              </div>
            </div>
          </div>
          <div class="text-center mt-3">
            <i class="fas fa-arrow-left btn-icon btn-back" (click)="goBack()" title="Back to Users"></i>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Add Program Confirmation Modal -->
  <div class="modal fade" id="addProgramConfirmModal" tabindex="-1" aria-labelledby="addProgramConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addProgramConfirmModalLabel">Confirm Add Program</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Dynamic content set by initiateAddProgram -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="confirmAddProgram(false)">Cancel</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal" (click)="confirmAddProgram(true)">Add</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Remove Program Confirmation Modal -->
  <div class="modal fade" id="removeProgramConfirmModal" tabindex="-1" aria-labelledby="removeProgramConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="removeProgramConfirmModalLabel">Confirm Remove Program</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Dynamic content set by initiateRemoveProgram -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="confirmRemoveProgram(false)">Cancel</button>
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal" (click)="confirmRemoveProgram(true)">Remove</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="successModalLabel">Success</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Dynamic content set by showSuccessModal -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Modal -->
  <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="errorModalLabel">Error</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Dynamic content set by showErrorModal -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</main>
<app-admin-footer></app-admin-footer>